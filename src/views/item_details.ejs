<% layout("/layouts/boilerplate") %>

  <div class="row mt-2">
    <div class="col-8 offset-3 listing-title">
      <h3>
        <%=targetData.title%>
      </h3>
    </div>

    <div class="card col-6 offset-3 listing-card">
      <img src="<%=targetData.image.url%>" class="card-img-top detail-section-img" alt="...">

      <div class="card-body ">
        <p class="card-text">
          <%if(targetData.owner){%>
          Owned by
          <%=targetData.owner.username%>
          <%}%>
          
        </p>

        <p class="card-text mt-3">
          <%=targetData.description%><br>
            &#8377; <%=targetData.price.toLocaleString("en-In")%><br>
              <%=targetData.location%><br>
                <%=targetData.country%><br>
        </p>

      </div>
    </div>


    <div class="row">
      <div class="col-6 offset-3 btns-box">
        <% if(currentUser && currentUser?._id.equals(targetData?.owner?._id)){%>
          <div class="update-btn">
            <a href="/lists/<%=targetData._id%>/update" class="btn btn-dark col-3 add-btn btn-size ">
              Update
            </a>
          </div>

          <form method="post" action="/lists/<%=targetData._id%>?_method=Delete">

            <div class="delete-btn">
              <button class="btn btn-dark col-3 btn-size ">
                Delete
              </button>
            </div>

          </form>
          <%}%>
      </div>
      
      <div class="row mt-1">
      <hr class="col-6 mx-auto ">
      </div>

      <div class="row listing-card">
        <div class="col-md-7 offset-md-3 fw-bold">
          Google Map
        </div>
        <div class="col-md-7 offset-md-3 fst-italic loadingText" >
          Identifing location...
        </div>
        <div class="col-md-7 offset-md-3 mapContainer" style="display:none">
        <iframe
          width="100%"
          height="300"
          frameborder="0" style="border:0" 
          src="https://www.google.com/maps?q=<%=encodeURIComponent(targetData.location +', ' +targetData.country)%>&amp;output=embed"
          onload="document.getElementsByClassName('loadingText')[0].style.display='none'; document.getElementsByClassName('mapContainer')[0].style.display='block'">
        </iframe>
      </div>
      </div>

      <div class="col-8 offset-3 mb-2 mt-2 rating-card">
        <% if(currentUser && !currentUser._id.equals(targetData?.owner?._id)){%>

          <form novalidate class="mb-1 mt-2 needs-validation" action="/lists/<%=targetData._id%>/reviews"method="POST">

            <div>
              <hr>
              <label for="rating" class="form-label">
                Rating
              </label>

              <fieldset class="starability-slot star-symbol">
                <input type="radio" id="no-rating" class="input-no-rate" name="review[rating]" aria-label="No rating."
                  value="1" checked />

                <input type="radio" id="second-rate1" name="review[rating]" value="1" />

                <label for="second-rate1" title="Terrible">
                  1 star
                </label>

                <input type="radio" id="second-rate2" name="review[rating]" value="2" />

                <label for="second-rate2" title="Not good">
                  2 stars
                </label>

                <input type="radio" id="second-rate3" name="review[rating]" value="3" />

                <label for="second-rate3" title="Average">
                  3 stars
                </label>

                <input type="radio" id="second-rate4" name="review[rating]" value="4" />

                <label for="second-rate4" title="Very good">
                  4 stars
                </label>

                <input type="radio" id="second-rate5" name="review[rating]" value="5" />

                <label for="second-rate5" title="Amazing">
                  5 stars
                </label>

              </fieldset>
            </div>

            <div class="mb-3comment-box">
              <label for="comment" class="form-label">
                Comments
              </label>
              <br>
              <textarea  required class="form-control" name="review[comment]" id="comment" cols="50" rows="5" ></textarea>
            </div>

            <button class="btn btn-outline-dark mt-1">
              Submit
            </button>
          </form>
          <%}%>
      </div>

        <div class="row mt-1">
          <hr class="col-6 mx-auto ">
          </div>
         
            <div class="row listing-card">
             
              <% if(targetData.reviews.length>0){ %>
                <div class="col-6 offset-3">
                  <p>
                    <b>All Reviews</b>
                  </p>
                </div>

                <%for(review of targetData.reviews){%>
                  <div class="card mx-auto mb-3 review-card col-6 offset-3">
                    <div class="card-body">
                      <h6 class="card-title">
                        <i>@<%=review.author.username%></i>
                      </h6>

                      <div class="showing-rating-star">
                        <p class="starability-result " data-rating="<%=review.rating%>">Rated: 3 stars</p>
                      </div>

                      <div class="showing-rating-text-based">
                        <p>
                          <%=review.rating%> Star
                        </p>
                      </div>

                      <p class="card-text">
                        <%=review.comment%>
                      </p>



                    </div>
                    <form action="/lists/<%=targetData._id%>/reviews/<%=review._id%>?_method=Delete" method="post"
                      class="mb-3">
                      <button class="btn btn-sm btn-dark mb-2 mt-1">Delete</button>
                    </form>
                  </div>

                  <%}%>
            </div>
            <%}%>
        
    </div>

      
     



  </div>